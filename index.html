<?php require 'config.php'; ?>
<?php
/*$ime = "alen";
echo "$ime je glup";*/

// google client id 	1082983336226-ph2q77qr0crnhgijo1sa9ib5efijsl2h.apps.googleusercontent.com
// google client secret 	j6EK8cNcaeanb2vgr4_7BTo-

// isset - Returns TRUE if var exists and has value other than NULL. FALSE otherwise.
//	$_POST -  is used to collect form-data.
if(isset($_POST['reg'])){
	//session_start() creates a session or resumes the current one based on a session identifier passed via a GET or POST request, or passed via a cookie.
	session_start();
	// spremanje podataka dobivenih $_POST['podatak']; metodom u varijable
	$email= $_POST['inputEmail'];
	$uname= $_POST['username'];
	$sifra= $_POST['inputPws'];
	$sifra2= $_POST['inputConfirmPws'];
	
	// provjera passworda i confirm passworda
	if ( $sifra == $sifra2){
	
	// hashiranje  string password_hash ( string $password , integer $algo [, array $options ] )
	// PASSWORD_BCRYPT - Use the CRYPT_BLOWFISH algorithm to create the hash. This will produce a standard crypt() compatible hash using the "$2y$" identifier.
	// The result will always be a 60 character string, or FALSE on failure.
	$PWhash = password_hash($sifra, PASSWORD_BCRYPT, array ('cost' => 10 ));
	
	// Performs a query on the database
	$sql = mysqli_query ($conn, "select id from korisnik where email = '".$email."'  ");
		// Returns an associative array that corresponds to the fetched row or NULL if there are no more rows.
		if ( mysqli_fetch_assoc($sql) != 0)
		{
			// treba zamjeniti na neki normalan nacin
			echo "<br><br>User with that e-mail already exists";
		}else{
			// hashirana sifra
			$sql2 = mysqli_query($conn, "INSERT INTO korisnik (email, sifra, ime)VALUES ('$email', '$PWhash', '$uname')");
			
			//$sql = $conn->query("INSERT INTO korisnik (email, sifra, ime)VALUES ('$email', '$sifra', '$uname')");
			// isto kao i za echo
			echo "<Account created successfully!!)";
		}
		
	}else{
	echo "Password and Confirm password are not the same!";
	}
	
	
			
	
				
}

?>
<?php
	
	if(isset($_POST['Login'])){
		
		$EM = $_POST['email2'];
		$PW = $_POST['pws'];
		
		
		$result = mysqli_query($conn, "SELECT * FROM korisnik where email='".$EM."' ");
		// mysqli_fetch_array() is an extended version of the mysqli_fetch_row() function. In addition to storing the data in the numeric indices of the result array,
		// the mysqli_fetch_array() function can also store the data in associative indices, using the field names of the result set as keys.
		$row = mysqli_fetch_array($result,MYSQLI_BOTH);
		
		// Verifies that the given hash matches the given password.
		if (password_verify($PW, $row['sifra'])) {	
			//session_start() creates a session or resumes the current one based on a session identifier passed via a GET or POST request, or passed via a cookie.
			session_start();
		
		$_SESSION["UserID"] = $row[0];
		$_SESSION["UserEmail"] = $row[1];
		$_SESSION["UserPW"] = $row[2];
		$_SESSION["UserName"] = $row[3];
		
		session_start();
		// switching to another website or refreshing the current site
		//header('Location: main/index.html');	
		printf ("<br>Dobrodosao ");
		printf ( $_SESSION["UserName"]);
		}
		else{
			session_start();

			 echo "Failed to connect to MySQL: " . mysqli_connect_error();	
		}
	
	}
?>
<!DOCTYPE html>
<html lang="en">


<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style2.css">
	
</head>

<body>



    <nav class="navbar navbar-default">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
		
                <a class="navbar-brand" href="#">JustDoIT</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">To-Do</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-log-in"></span> Login</a> </li>
                    <li><a href="#" data-toggle="modal" data-target="#myModal2"><span class="glyphicon glyphicon-user"></span> Sign Up</a> </li>
                </ul>

            </div>



        </div>
    </nav>
    <!-- Modal Login-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                    <h4 class="modal-title" id="myModalLabel">Login form</h4>
                </div>
                <div class="modal-body">
                    <form action="" method="post" >
						
                        <div class="form-group">
                            <label for="email">Email address</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input type="email" class="form-control" name="email2" id="email2" placeholder="Email">

                            </div>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
                                <input type="password" class="form-control" name="pws" id="pws" placeholder="Password">
                            </div>
                        </div>
                   
				</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="submit" name="Login" id="Login" class="btn btn-primary">Log in</button>
						
					</div>
					</form>
            </div>
        </div>
    </div>
    <!--Modal Registracija-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                    <h4 class="modal-title" id="myModalLabel">Registration form</h4>
                </div>
                <div class="modal-body">
                    <form class="pb-modalreglog-form-reg" action="" method="post">

                        <div class="form-group">
                            <label for="email">Email address</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input type="email" class="form-control" name="inputEmail" id="inputEmail" placeholder="Email" 
								pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" required="required" title="Incorret e-mail format">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="username">Username</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input type="text" class="form-control"  name="username" id="username" placeholder="Username" pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{5,20}$" type="text" required="required" 
								title="Username can only contain lowercase, uppercase letters and numbers. Minimum 5 characters. ">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
                                <input type="password" class="form-control" name="inputPws" id="inputPws" placeholder="Password" pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{5,20}$" required="required" 
								title="Password can only contain lowercase, uppercase letters and numbers. Minimum 5 characters.">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmpassword">Confirm password</label>
                            <div class="input-group pb-modalreglog-input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
								<input type="password" class="form-control" name="inputConfirmPws" id="inputConfirmPws" placeholder="Confirm Password" pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{5,20}$" required="required" 
								title="Password can only contain lowercase, uppercase letters and numbers. Minimum 5 characters.">
                            </div>
                        </div>

                        <div class="form-group">
                            <input type="checkbox" id="ch" name="chs"> I agree with <a href="#">terms and conditions.</a>
                        </div>
               
                </div>
				
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" name="reg" id="reg"  class="btn btn-primary">Sign up</button>
				 </form>
                </div>
            </div>
        </div>
    </div>


    <!--naslovslika-->
    <div class="jumbotron" id="box-wrapper">

        <div id="t1" class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6 wow bounceInLeft">
                    <h1>To do list</h1>
                    <p> The best app of all time. Never forget about anything ever again. This app will change your life forever. Now available on your phone, pc or tablet</p>
                    <button class="btn btn-lg btn-primary">Download App</button>
                    <button class="btn btn-lg btn-success">Download Extension</button>
                </div>
                <div class="col-md-4"></div>
            </div>
        </div>

    </div>

</body>

</html>
